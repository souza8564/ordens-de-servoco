<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ordens de Serviço Interno</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #a9a9a9;
            -webkit-tap-highlight-color: transparent;
        }
        .main-layout {
            display: flex;
            min-height: 100vh;
            flex-direction: row;
        }
        .sidebar {
            width: 220px;
            background: #222;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            padding-top: 0;
            box-shadow: 2px 0 8px #0002;
            z-index: 10;
        }
        .sidebar-header {
            background:#39ff14;
            color:#111;
            text-align:center;
            border-radius:0 0 8px 8px;
            padding:24px 0 10px 0;
            box-shadow:0 0 8px #39ff14;
            margin-bottom: 18px;
            font-family:sans-serif;
            font-size:2em;
            letter-spacing:2px;
            font-weight:bold;
        }
        .sidebar-header .subtitle {
            font-size:0.8em;
            color:#00843d;
            font-weight:normal;
            display:block;
            margin-top:-2px;
            font-style:italic;
        }
        .sidebar-menu {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .sidebar-btn {
            display: flex;
            align-items: center;
            gap: 14px;
            background: none;
            border: none;
            color: #fff;
            font-size: 1.08em;
            padding: 14px 24px;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            text-align: left;
        }
        .sidebar-btn.active, .sidebar-btn:hover {
            background: #39ff14;
            color: #222;
        }
        .sidebar-btn svg {
            width: 22px;
            height: 22px;
            fill: currentColor;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 32px 32px 32px 32px;
            flex: 1;
            box-sizing: border-box;
        }
        .tabcontent {
            display: none;
            padding: 0;
            border: none;
            border-radius: 0;
            background: none;
            animation: fadeEffect 0.7s;
        }
        .tabcontent.active {
            display: block;
        }
        /* Estilos para formulários */
        .os-card {
            max-width: 700px;
            margin: 0 auto 32px auto;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 16px #0001;
            padding: 32px 32px 24px 32px;
        }
        .os-card h2 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 24px;
            color: #00843d;
        }
        .os-card form {
            display: flex;
            flex-wrap: wrap;
            gap: 24px 32px;
        }
        .form-group {
            flex: 1 1 220px;
            min-width: 180px;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        label {
            font-weight: 500;
            color: #222;
        }
        input[type="text"],
        input[type="date"],
        input[type="tel"],
        select,
        textarea {
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            background: #f9f9f9;
            transition: border 0.2s;
        }
        input[type="text"]:focus,
        input[type="date"]:focus,
        input[type="tel"]:focus,
        select:focus,
        textarea:focus {
            border: 1.5px solid #39ff14;
            outline: none;
        }
        button[type="submit"] {
            width: 100%;
            margin-top: 12px;
            padding: 12px 0;
            background: linear-gradient(90deg,#39ff14 60%,#00843d 100%);
            color: #111;
            font-weight: bold;
            font-size: 1.1em;
            border: none;
            border-radius: 6px;
            box-shadow: 0 2px 8px #39ff1422;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        button[type="submit"]:hover {
            background: linear-gradient(90deg,#00843d 0%,#39ff14 100%);
            color: #fff;
        }
        /* Tabelas */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .btn-action {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .btn-edit {
            background-color: #00843d;
            color: white;
            margin-right: 5px;
        }
        .btn-delete {
            background-color: #d00;
            color: white;
        }
        .btn-print {
            background-color: #39f;
            color: white;
        }
        /* Status da OS */
        .status-pendente {
            color: #d00;
            font-weight: bold;
        }
        .status-andamento {
            color: #f90;
            font-weight: bold;
        }
        .status-concluida {
            color: #00843d;
            font-weight: bold;
        }
        .status-cancelada {
            color: #888;
            font-weight: bold;
        }
        /* Responsividade */
        @media (max-width: 900px) {
            .main-layout {
                flex-direction: column;
            }
            .sidebar {
                flex-direction: row;
                width: 100vw;
                height: auto;
                min-width: 0;
                max-width: 100vw;
                overflow-x: auto;
                box-shadow: 0 2px 8px #0002;
                border-radius: 0 0 12px 12px;
                padding: 0;
            }
            .sidebar-header {
                display: none;
            }
            .sidebar-menu {
                flex-direction: row;
                gap: 0;
                width: 100vw;
                overflow-x: auto;
            }
            .sidebar-btn {
                flex: 1 1 120px;
                min-width: 120px;
                font-size: 1em;
                padding: 12px 4px;
                justify-content: center;
                border-radius: 0;
                border-right: 1px solid #333;
            }
            .sidebar-btn:last-child {
                border-right: none;
            }
        }
        @media (max-width: 700px) {
            html {
                font-size: 15px;
            }
            .container {
                max-width: 100vw;
                padding: 4vw 0 18vw 0;
            }
            .os-card {
                padding: 10px 2vw 10px 2vw;
                max-width: 100vw;
                box-sizing: border-box;
            }
            .os-card form {
                flex-direction: column;
                gap: 12px;
                padding: 0;
            }
            .form-group {
                min-width: 0;
                width: 100%;
            }
            table {
                font-size: 0.97em;
            }
            th, td {
                padding: 6px 2px;
            }
            .sidebar {
                font-size: 0.95em;
            }
        }
        @media (max-width: 520px) {
            html {
                font-size: 14px;
            }
            .container {
                padding: 1vw 0 12vw 0;
            }
            .os-card {
                padding: 4px 0 4px 0;
            }
            table, th, td {
                font-size: 0.92em;
            }
            .sidebar-btn {
                min-width: 80px;
                font-size: 0.91em;
                padding: 8px 1px;
            }
        }
        /* Tabela responsiva */
        @media (max-width: 700px) {
            table {
                display: block;
                width: 100%;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            thead {
                display: none;
            }
            tbody, tr, td {
                display: block;
                width: 100%;
            }
            tr {
                margin-bottom: 14px;
                border-radius: 10px;
                box-shadow: 0 1px 6px #0001;
                background: #fff;
                padding: 10px 0;
            }
            td {
                border: none;
                position: relative;
                padding-left: 46%;
                min-height: 32px;
                box-sizing: border-box;
                margin-bottom: 6px;
            }
            td:before {
                position: absolute;
                left: 8px;
                top: 8px;
                width: 44%;
                white-space: nowrap;
                font-weight: bold;
                color: #00843d;
                font-size: 0.98em;
            }
            #tabela-solicitantes td:nth-child(1):before { content: 'Nome'; }
            #tabela-solicitantes td:nth-child(2):before { content: 'Setor'; }
            #tabela-solicitantes td:nth-child(3):before { content: 'Contato'; }
            #tabela-solicitantes td:nth-child(4):before { content: 'Ações'; }
            
            #tabela-tecnicos td:nth-child(1):before { content: 'Nome'; }
            #tabela-tecnicos td:nth-child(2):before { content: 'Especialidade'; }
            #tabela-tecnicos td:nth-child(3):before { content: 'Contato'; }
            #tabela-tecnicos td:nth-child(4):before { content: 'Ações'; }
            
            #tabela-os td:nth-child(1):before { content: 'Número'; }
            #tabela-os td:nth-child(2):before { content: 'Solicitante'; }
            #tabela-os td:nth-child(3):before { content: 'Setor'; }
            #tabela-os td:nth-child(4):before { content: 'Equipamento'; }
            #tabela-os td:nth-child(5):before { content: 'Data'; }
            #tabela-os td:nth-child(6):before { content: 'Status'; }
            #tabela-os td:nth-child(7):before { content: 'Ações'; }
            
            #tabela-historico td:nth-child(1):before { content: 'Número'; }
            #tabela-historico td:nth-child(2):before { content: 'Solicitante'; }
            #tabela-historico td:nth-child(3):before { content: 'Setor'; }
            #tabela-historico td:nth-child(4):before { content: 'Equipamento'; }
            #tabela-historico td:nth-child(5):before { content: 'Data'; }
            #tabela-historico td:nth-child(6):before { content: 'Status'; }
            #tabela-historico td:nth-child(7):before { content: 'Ações'; }
        }
        /* Impressão */
        .print-only {
            display: none;
        }
        @media print {
            body > *:not(.print-only):not(.container) {
                display: none !important;
            }
            .print-only {
                display: block !important;
                page-break-after: always;
            }
            html, body {
                background: #fff !important;
            }
        }
    </style>
</head>
<body>
    <div class="main-layout">
        <nav class="sidebar">
            <div class="sidebar-header">
                ambipar <span class="subtitle">environment</span>
            </div>
            <div class="sidebar-menu">
                <button class="sidebar-btn active" data-tab="dashboard">
                    <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                    Painel
                </button>
                <button class="sidebar-btn" data-tab="solicitantes">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                    Solicitantes
                </button>
                <button class="sidebar-btn" data-tab="tecnicos">
                    <svg viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/><path d="M10.05 16.05c-.73.73-1.15 1.15-1.8 2.2.71.14 1.46.22 2.25.22.79 0 1.54-.08 2.25-.22-.65-1.05-1.08-1.47-1.8-2.2-.47-.48-.84-.84-1.2-1.2-.36.36-.73.72-1.2 1.2z"/></svg>
                    Técnicos
                </button>
                <button class="sidebar-btn" data-tab="nova-os">
                    <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                    Nova OS
                </button>
                <button class="sidebar-btn" data-tab="gerenciar-os">
                    <svg viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zm0-6v2h14V7H7z"/></svg>
                    Gerenciar OS
                </button>
                <button class="sidebar-btn" data-tab="historico-os">
                    <svg viewBox="0 0 24 24"><path d="M13 3a9 9 0 1 0 8.95 10.11h-2.02A7 7 0 1 1 12 5v4l3.89-3.89L12 2v4a9 9 0 0 0 1 17.93V21a7 7 0 1 1 7-7h2a9 9 0 0 0-9-9z"/></svg>
                    Histórico
                </button>
                <button class="sidebar-btn" data-tab="relatorios">
                    <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zM7 10h2v7H7zm4-3h2v10h-2zm4 6h2v4h-2z"/></svg>
                    Relatórios
                </button>
            </div>
        </nav>
        <div class="container">
            <!-- Painel Dashboard -->
            <div id="dashboard" class="tabcontent active">
                <div class="os-card">
                    <h2>Painel de Controle</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; border-left: 5px solid #39ff14;">
                            <h3 style="margin-top: 0; color: #00843d;">OS Pendentes</h3>
                            <p style="font-size: 2em; font-weight: bold;" id="count-pendentes">0</p>
                        </div>
                        <div style="background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; border-left: 5px solid #f90;">
                            <h3 style="margin-top: 0; color: #f90;">OS em Andamento</h3>
                            <p style="font-size: 2em; font-weight: bold;" id="count-andamento">0</p>
                        </div>
                        <div style="background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; border-left: 5px solid #00843d;">
                            <h3 style="margin-top: 0; color: #00843d;">OS Concluídas</h3>
                            <p style="font-size: 2em; font-weight: bold;" id="count-concluidas">0</p>
                        </div>
                    </div>
                    
                    <h3>OS Urgentes</h3>
                    <div id="os-urgentes" style="margin-bottom: 30px;"></div>
                    
                    <h3>Próximos Vencimentos</h3>
                    <div id="proximos-vencimentos"></div>
                </div>
            </div>
            
            <!-- Cadastro de Solicitantes -->
            <div id="solicitantes" class="tabcontent">
                <div class="os-card">
                    <h2>Cadastrar Solicitante</h2>
                    <form id="solicitanteForm">
                        <div class="form-group">
                            <label for="solicitante-nome">Nome:</label>
                            <input type="text" id="solicitante-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="solicitante-setor">Setor:</label>
                            <select id="solicitante-setor" required>
                                <option value="">Selecione um setor</option>
                                <option value="Produção">Produção</option>
                                <option value="Manutenção">Manutenção</option>
                                <option value="Qualidade">Qualidade</option>
                                <option value="Logística">Logística</option>
                                <option value="Administrativo">Administrativo</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="solicitante-contato">Contato:</label>
                            <input type="tel" id="solicitante-contato" required>
                        </div>
                        <button type="submit">Salvar Solicitante</button>
                    </form>
                </div>
                
                <div class="os-card">
                    <h3>Solicitantes Cadastrados</h3>
                    <table id="tabela-solicitantes">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Setor</th>
                                <th>Contato</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Cadastro de Técnicos -->
            <div id="tecnicos" class="tabcontent">
                <div class="os-card">
                    <h2>Cadastrar Técnico</h2>
                    <form id="tecnicoForm">
                        <div class="form-group">
                            <label for="tecnico-nome">Nome:</label>
                            <input type="text" id="tecnico-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="tecnico-especialidade">Especialidade:</label>
                            <select id="tecnico-especialidade" required>
                                <option value="">Selecione</option>
                                <option value="Eletricista">Eletricista</option>
                                <option value="Mecânico">Mecânico</option>
                                <option value="Eletrônico">Eletrônico</option>
                                <option value="Informática">Informática</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tecnico-contato">Contato:</label>
                            <input type="tel" id="tecnico-contato" required>
                        </div>
                        <button type="submit">Salvar Técnico</button>
                    </form>
                </div>
                
                <div class="os-card">
                    <h3>Técnicos Cadastrados</h3>
                    <table id="tabela-tecnicos">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Especialidade</th>
                                <th>Contato</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Nova Ordem de Serviço -->
            <div id="nova-os" class="tabcontent">
                <div class="os-card">
                    <h2>Nova Ordem de Serviço</h2>
                    <form id="osForm">
                        <div class="form-group">
                            <label for="os-solicitante">Solicitante:</label>
                            <select id="os-solicitante" required>
                                <option value="">Selecione um solicitante</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="os-setor">Setor:</label>
                            <select id="os-setor" required>
                                <option value="">Selecione um setor</option>
                                <option value="Produção">Produção</option>
                                <option value="Manutenção">Manutenção</option>
                                <option value="Qualidade">Qualidade</option>
                                <option value="Logística">Logística</option>
                                <option value="Administrativo">Administrativo</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="os-equipamento">Equipamento:</label>
                            <input type="text" id="os-equipamento" required>
                        </div>
                        <div class="form-group">
                            <label for="os-serial">Número de Patrimônio:</label>
                            <input type="text" id="os-serial">
                        </div>
                        <div class="form-group">
                            <label for="os-tecnico">Técnico Responsável:</label>
                            <select id="os-tecnico" required>
                                <option value="">Selecione um técnico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="os-data">Data de Abertura:</label>
                            <input type="date" id="os-data" required>
                        </div>
                        <div class="form-group">
                            <label for="os-prazo">Prazo para Conclusão:</label>
                            <input type="date" id="os-prazo">
                        </div>
                        <div class="form-group">
                            <label for="os-problema">Problema Relatado:</label>
                            <textarea id="os-problema" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="os-diagnostico">Diagnóstico Técnico:</label>
                            <textarea id="os-diagnostico" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="os-solucao">Solução Aplicada:</label>
                            <textarea id="os-solucao" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="os-status">Status:</label>
                            <select id="os-status" required>
                                <option value="pendente">Pendente</option>
                                <option value="andamento">Em Andamento</option>
                                <option value="concluida">Concluída</option>
                                <option value="cancelada">Cancelada</option>
                            </select>
                        </div>
                        <button type="submit">Salvar OS</button>
                    </form>
                </div>
            </div>
            
            <!-- Gerenciar OS -->
            <div id="gerenciar-os" class="tabcontent">
                <div class="os-card">
                    <h2>Gerenciar Ordens de Serviço</h2>
                    <div style="margin-bottom: 20px;">
                        <label for="filtro-status">Filtrar por Status:</label>
                        <select id="filtro-status">
                            <option value="">Todos</option>
                            <option value="pendente">Pendentes</option>
                            <option value="andamento">Em Andamento</option>
                            <option value="concluida">Concluídas</option>
                            <option value="cancelada">Canceladas</option>
                        </select>
                        <label for="filtro-tecnico" style="margin-left: 15px;">Filtrar por Técnico:</label>
                        <select id="filtro-tecnico">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <table id="tabela-os">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Solicitante</th>
                                <th>Setor</th>
                                <th>Equipamento</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <!-- Histórico de OS -->
            <div id="historico-os" class="tabcontent">
                <div class="os-card">
                    <h2>Histórico de Ordens de Serviço</h2>
                    <div style="margin-bottom: 20px;">
                        <label for="historico-setor">Filtrar por Setor:</label>
                        <select id="historico-setor">
                            <option value="">Todos</option>
                            <option value="Produção">Produção</option>
                            <option value="Manutenção">Manutenção</option>
                            <option value="Qualidade">Qualidade</option>
                            <option value="Logística">Logística</option>
                            <option value="Administrativo">Administrativo</option>
                            <option value="Outros">Outros</option>
                        </select>
                        <label for="historico-periodo" style="margin-left: 15px;">Período:</label>
                        <select id="historico-periodo">
                            <option value="30">Últimos 30 dias</option>
                            <option value="90">Últimos 90 dias</option>
                            <option value="365">Últimos 12 meses</option>
                            <option value="0">Todo o período</option>
                        </select>
                    </div>
                    <table id="tabela-historico">
                        <thead>
                            <tr>
                                <th>Número</th>
                                <th>Solicitante</th>
                                <th>Setor</th>
                                <th>Equipamento</th>
                                <th>Data</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <div style="margin-top: 20px;">
                        <button onclick="exportarHistoricoExcel()">Exportar para Excel</button>
                        <button onclick="imprimirHistorico()" style="margin-left: 10px;">Imprimir Relatório</button>
                    </div>
                </div>
            </div>
            
            <!-- Relatórios -->
            <div id="relatorios" class="tabcontent">
                <div class="os-card">
                    <h2>Relatórios</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3 style="margin-top: 0; color: #00843d;">OS por Status</h3>
                            <canvas id="chart-status" height="200"></canvas>
                        </div>
                        <div style="background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3 style="margin-top: 0; color: #00843d;">OS por Técnico</h3>
                            <canvas id="chart-tecnicos" height="200"></canvas>
                        </div>
                        <div style="background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <h3 style="margin-top: 0; color: #00843d;">OS por Setor</h3>
                            <canvas id="chart-setores" height="200"></canvas>
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <button onclick="gerarRelatorioCompleto()">Gerar Relatório Completo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para visualização/impressão de OS -->
    <div id="modal-os" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; overflow: auto;">
        <div style="background: white; max-width: 800px; margin: 30px auto; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.2);">
            <div id="os-print-content">
                <!-- Conteúdo da OS será inserido aqui -->
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="imprimirOS()" style="padding: 10px 20px; background: #39ff14; color: #111; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">Imprimir OS</button>
                <button onclick="fecharModalOS()" style="padding: 10px 20px; background: #d00; color: white; border: none; border-radius: 5px; margin-left: 15px; font-weight: bold; cursor: pointer;">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Firebase App (core) -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <!-- Firestore -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script>
      // Configuração do Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyD4FH7GjivSwsnhqCGvYdYd6AYpLrulGRQ",
        authDomain: "ordens-servico-37369.firebaseapp.com",
        projectId: "ordens-servico-37369",
        storageBucket: "ordens-servico-37369.appspot.com",
        messagingSenderId: "956106820939",
        appId: "1:956106820939:web:fb5df0102c23c506036cce",
        measurementId: "G-15FMG1E6BM"
      };

      // Inicializa o Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();
    </script>

    <script>
        // Banco de dados local
        let tecnicos = JSON.parse(localStorage.getItem('tecnicos')) || [];
        let ordensServico = JSON.parse(localStorage.getItem('ordensServico')) || [];
        let ultimoNumeroOS = parseInt(localStorage.getItem('ultimoNumeroOS')) || 0;

        // Inicialização do sistema
        document.addEventListener('DOMContentLoaded', function() {
            // Configura navegação entre abas
            const sidebarBtns = document.querySelectorAll('.sidebar-btn');
            const tabContents = document.querySelectorAll('.tabcontent');
            
            sidebarBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove 'active' de todos os botões e abas
                    sidebarBtns.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(tab => tab.classList.remove('active'));
                    
                    // Adiciona 'active' ao botão clicado e à aba correspondente
                    this.classList.add('active');
                    const tabId = this.getAttribute('data-tab');
                    const tab = document.getElementById(tabId);
                    if (tab) tab.classList.add('active');
                    
                    // Atualiza dados específicos da aba quando aberta
                    if (tabId === 'dashboard') atualizarDashboard();
                    if (tabId === 'solicitantes') atualizarTabelaSolicitantes();
                    if (tabId === 'tecnicos') atualizarTabelaTecnicos();
                    if (tabId === 'gerenciar-os') atualizarTabelaOS();
                    if (tabId === 'historico-os') atualizarTabelaHistorico();
                    if (tabId === 'relatorios') atualizarRelatorios();
                });
            });
            
            // Garante que a primeira aba esteja ativa ao carregar
            const btnAtivo = document.querySelector('.sidebar-btn.active');
            if (btnAtivo) {
                const tabId = btnAtivo.getAttribute('data-tab');
                const tab = document.getElementById(tabId);
                if (tab) tab.classList.add('active');
            }
            
            // Inicializa selects
            atualizarSelectSolicitantes();
            atualizarSelectTecnicos();
            atualizarSelectFiltroTecnicos();
            
            // Configura formulários
            configurarFormularios();
            
            // Atualiza dashboard
            atualizarDashboard();
            
            // Atualiza tabelas
            atualizarTabelaSolicitantes();
            atualizarTabelaTecnicos();
            atualizarTabelaOS();
            atualizarTabelaHistorico();
            
            // Configura data atual no formulário de OS
            document.getElementById('os-data').valueAsDate = new Date();
        });

        // --- FIRESTORE: CRUD SOLICITANTES ---
let solicitantes = [];

// Carrega solicitantes do Firestore ao iniciar
async function carregarSolicitantesFirestore() {
    const snapshot = await db.collection('solicitantes').get();
    solicitantes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    atualizarTabelaSolicitantes();
    atualizarSelectSolicitantes();
}

// Adiciona solicitante no Firestore
async function adicionarSolicitanteFirestore(solicitante) {
    try {
        const docRef = await db.collection('solicitantes').add(solicitante);
        solicitante.id = docRef.id;
        // Após adicionar, recarrega toda a lista do Firestore para garantir consistência
        await carregarSolicitantesFirestore();
    } catch (e) {
        alert('Erro ao salvar solicitante no Firestore: ' + (e.message || e));
    }
}

// Remove solicitante do Firestore
async function removerSolicitanteFirestore(id) {
    await db.collection('solicitantes').doc(id).delete();
    solicitantes = solicitantes.filter(s => s.id !== id);
    atualizarTabelaSolicitantes();
    atualizarSelectSolicitantes();
}

// Atualiza solicitante no Firestore
async function atualizarSolicitanteFirestore(id, novosDados) {
    await db.collection('solicitantes').doc(id).update(novosDados);
    const idx = solicitantes.findIndex(s => s.id === id);
    if (idx !== -1) Object.assign(solicitantes[idx], novosDados);
    atualizarTabelaSolicitantes();
    atualizarSelectSolicitantes();
}

// --- Substitui o CRUD local por Firestore ---
function configurarFormularios() {
    // Formulário de solicitante
    const solicitanteForm = document.getElementById('solicitanteForm');
    if (solicitanteForm) {
        solicitanteForm.onsubmit = async function(e) {
            e.preventDefault();
            const nome = document.getElementById('solicitante-nome').value.trim();
            const setor = document.getElementById('solicitante-setor').value;
            const contato = document.getElementById('solicitante-contato').value.trim();
            if (!nome || !setor || !contato) {
                alert('Preencha todos os campos obrigatórios.');
                return;
            }
            await adicionarSolicitanteFirestore({ nome, setor, contato });
            solicitanteForm.reset();
            // Mensagem de sucesso só se não houve erro
            alert('Solicitante cadastrado com sucesso!');
        };
    }
    
    // Formulário de técnico
    const tecnicoForm = document.getElementById('tecnicoForm');
    if (tecnicoForm) {
        tecnicoForm.onsubmit = function(e) {
            e.preventDefault();
            
            const nome = document.getElementById('tecnico-nome').value.trim();
            const especialidade = document.getElementById('tecnico-especialidade').value;
            const contato = document.getElementById('tecnico-contato').value.trim();
            
            if (!nome || !especialidade || !contato) {
                alert('Preencha todos os campos obrigatórios.');
                return;
            }
            
            // Gera ID único
            const id = Date.now().toString();
            
            tecnicos.push({
                id,
                nome,
                especialidade,
                contato
            });
            
            localStorage.setItem('tecnicos', JSON.stringify(tecnicos));
            atualizarTabelaTecnicos();
            atualizarSelectTecnicos();
            atualizarSelectFiltroTecnicos();
            
            tecnicoForm.reset();
            alert('Técnico cadastrado com sucesso!');
        };
    }
    
    // Formulário de OS
    const osForm = document.getElementById('osForm');
    if (osForm) {
        osForm.onsubmit = function(e) {
            e.preventDefault();
            
            const solicitanteId = document.getElementById('os-solicitante').value;
            const setor = document.getElementById('os-setor').value;
            const equipamento = document.getElementById('os-equipamento').value.trim();
            const serial = document.getElementById('os-serial').value.trim();
            const tecnicoId = document.getElementById('os-tecnico').value;
            const data = document.getElementById('os-data').value;
            const prazo = document.getElementById('os-prazo').value;
            const problema = document.getElementById('os-problema').value.trim();
            const diagnostico = document.getElementById('os-diagnostico').value.trim();
            const solucao = document.getElementById('os-solucao').value.trim();
            const status = document.getElementById('os-status').value;
            
            if (!solicitanteId || !setor || !equipamento || !tecnicoId || !data || !problema) {
                alert('Preencha todos os campos obrigatórios.');
                return;
            }
            
            // Incrementa número da OS
            ultimoNumeroOS++;
            localStorage.setItem('ultimoNumeroOS', ultimoNumeroOS);
            
            // Gera ID único
            const id = Date.now().toString();
            
            ordensServico.push({
                id,
                numero: ultimoNumeroOS,
                solicitanteId,
                setor,
                equipamento,
                serial,
                tecnicoId,
                data,
                prazo,
                problema,
                diagnostico,
                solucao,
                status,
                dataConclusao: status === 'concluida' ? new Date().toISOString().split('T')[0] : null
            });
            
            localStorage.setItem('ordensServico', JSON.stringify(ordensServico));
            atualizarTabelaOS();
            atualizarTabelaHistorico();
            atualizarDashboard();
            
            osForm.reset();
            document.getElementById('os-data').valueAsDate = new Date();
            
            alert(`Ordem de Serviço #${ultimoNumeroOS} cadastrada com sucesso!`);
            
            // Pergunta se deseja imprimir a OS
            if (confirm('Deseja imprimir esta ordem de serviço?')) {
                visualizarOS(id);
            }
        };
    }
    
    // Filtros da tabela OS
    document.getElementById('filtro-status').addEventListener('change', atualizarTabelaOS);
    document.getElementById('filtro-tecnico').addEventListener('change', atualizarTabelaOS);
    
    // Filtros do histórico
    document.getElementById('historico-setor').addEventListener('change', atualizarTabelaHistorico);
    document.getElementById('historico-periodo').addEventListener('change', atualizarTabelaHistorico);
}

function atualizarTabelaSolicitantes() {
    const tbody = document.querySelector('#tabela-solicitantes tbody');
    if (!tbody) return;
    
    tbody.innerHTML = '';
    
    solicitantes.forEach(solicitante => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${solicitante.nome}</td>
            <td>${solicitante.setor}</td>
            <td>${solicitante.contato}</td>
            <td>
                <button class="btn-action btn-edit" data-id="${solicitante.id}">Editar</button>
                <button class="btn-action btn-delete" data-id="${solicitante.id}">Remover</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
    
    // Configura eventos dos botões
    document.querySelectorAll('.btn-edit').forEach(btn => {
        btn.addEventListener('click', function() {
            const solicitanteId = this.getAttribute('data-id');
            editarSolicitante(solicitanteId);
        });
    });
    
    document.querySelectorAll('.btn-delete').forEach(btn => {
        btn.addEventListener('click', async function() {
            const solicitanteId = this.getAttribute('data-id');
            if (confirm('Tem certeza que deseja remover este solicitante?')) {
                await removerSolicitanteFirestore(solicitanteId);
            }
        });
    });
}

function atualizarSelectSolicitantes() {
    const select = document.getElementById('os-solicitante');
    if (!select) return;
    
    select.innerHTML = '<option value="">Selecione um solicitante</option>';
    solicitantes.forEach(solicitante => {
        const option = document.createElement('option');
        option.value = solicitante.id;
        option.textContent = `${solicitante.nome} - ${solicitante.setor}`;
        select.appendChild(option);
    });
}

async function editarSolicitante(solicitanteId) {
    const solicitante = solicitantes.find(s => s.id === solicitanteId);
    if (!solicitante) return;
    
    const novoNome = prompt('Nome:', solicitante.nome);
    if (novoNome === null) return;
    
    const novoSetor = prompt('Setor:', solicitante.setor);
    if (novoSetor === null) return;
    
    const novoContato = prompt('Contato:', solicitante.contato);
    if (novoContato === null) return;
    
    await atualizarSolicitanteFirestore(solicitanteId, {
        nome: novoNome.trim(),
        setor: novoSetor.trim(),
        contato: novoContato.trim()
    });
}

// Ao iniciar, carrega solicitantes do Firestore
carregarSolicitantesFirestore();
    </script>
</body>
</html>